<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flores</title>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.4/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap5.min.css" />
</head>

<body>
    <!-- <div class="container mt-5">
        <h1 class="mb-4">Tabla de Ventas</h1>
        <div class="mb-3">
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#agregarModal">
                Agregar Venta
            </button>
        </div>
        <div class="mb-3">
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addSaleModal">
                addSaleModal
            </button>
        </div>
        <table id="ventasTable" class="table table-dark table-striped table-bordered">
            <thead>
                <tr>
                    <th>SKU</th>
                    <th>Cantidad</th>
                    <th>Precio</th>
                    <th>Total</th>
                    <th>Fecha</th>
                    <th>Método Pago</th>
                    <th>Producto</th>
                    <th>Cliente</th>
                    <th>Resto Venta</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <% data.forEach(venta=> { %>
                    <tr>
                        <td>
                            <%= venta.sku_producto %>
                        </td>
                        <td>
                            <%= venta.cantidad_producto %>
                        </td>
                        <td>
                            <%= venta.precio_producto %>
                        </td>
                        <td>
                            <%= venta.total %>
                        </td>
                        <td>
                            <%= venta.fecha_venta %>
                        </td>
                        <td>
                            <%= venta.metodo_pago %>
                        </td>
                        <td>
                            <%= venta.nombre_producto %>
                        </td>
                        <td>
                            <%= venta.nombre_cliente %>
                        </td>
                        <td>
                            <%= venta.resto_venta %>
                        </td>
                        <td>
                            <%= venta.estado %>
                        </td>
                        <td>
                            <a href="#" class="btn btn-sm btn-primary edit-btn" data-bs-toggle="modal"
                                data-bs-target="#editModal" data-id="<%= venta.id %>">Editar</a>
                            &nbsp; &nbsp;
                            <a href="#" class="btn btn-sm btn-danger delete-btn" data-bs-toggle="modal"
                                data-bs-target="#deleteModal" data-id="<%= venta.id %>">Eliminar</a>
                        </td>
                    </tr>
                    <% }) %>
            </tbody>
        </table>
    </div> -->

    <!-- Tabla Ventas  -->
    <div class="container mt-5">
        <h1 class="mb-4">Tabla de Ventas</h1>
        <div class="mb-3">
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addSaleModal">
                Agregar Venta
            </button>
        </div>
        <table id="salesTable" class="table table-dark table-striped table-bordered">
            <thead>
                <tr>
                    <th>Ticket</th>
                    <th>Productos</th>
                    <th>Cliente</th>
                    <th>Fecha</th>
                    <th>Método Pago</th>
                    <th>Total</th>
                    <th>Monto Pagado</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <% sales.forEach(sale =>  { %>
                    <tr>
                        <td>
                            <%= sale.ticket_number %>
                        </td>
                        <td>
                            <%= sale.products %>
                        </td>
                        <td>
                            <%= sale.id_client %> 
                        </td>
                        <td>
                            <%= sale.date %>
                        </td>
                        <td>
                            <%= sale.payment_method %>
                        </td>
                        <td>
                            <%= sale.total_amount_formated %>
                        </td>
                        <td>
                            <%= sale.amount_paid %>
                        </td>
                        <td>
                            <%= sale.status %>
                        </td>
                        <td>
                            <a href="#" class="btn btn-sm btn-primary edit-btn" data-bs-toggle="modal"
                                data-bs-target="#editModal" data-id="<%= sale.id %>">Editar</a>
                            &nbsp; &nbsp;
                            <a href="#" class="btn btn-sm btn-danger delete-btn" data-bs-toggle="modal"
                                data-bs-target="#deleteModal" data-id="<%= sale.id %>">Eliminar</a>
                        </td>

                    </tr>
                    <% }) %>
            </tbody>
        </table>
    </div>



    <div class="container mt-5">
        <h1 class="mb-4">Tabla de Clientes</h1>
        <div class="mb-3">
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#agregarClienteModal">
                Agregar Cliente
            </button>
        </div>
        <table id="clientsTable" class="table table-dark table-striped table-bordered">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Rut</th>
                    <th>Email</th>
                    <th>Celular</th>
                    <th>Dirección</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <% clients.forEach(client=> { %>
                    <tr>
                        <td>
                            <%= client.name %>
                        </td>
                        <td>
                            <%= client.rut %>
                        </td>
                        <td>
                            <%= client.email %>
                        </td>
                        <td>
                            <%= client.cell_phone %>
                        </td>
                        <td>
                            <%= client.address %>
                        </td>
                        <td>
                            <a href="#" class="btn btn-sm btn-primary edit-btn" data-bs-toggle="modal"
                                data-bs-target="#editClientModal" data-id="<%= client.id %>">Editar</a>
                            &nbsp; &nbsp;
                            <a href="#" class="btn btn-sm btn-danger delete-btn" data-bs-toggle="modal"
                                data-bs-target="#deleteClientModal" data-id="<%= client.id %>">Eliminar</a>
                        </td>
                    </tr>
                    <% }) %>
            </tbody>
        </table>
    </div>

    <!-- Tabla Productos  -->
    <div class="container mt-5">
        <h1 class="mb-4">Tabla de Productos</h1>
        <div class="mb-3">
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addProductModal">
                Agregar Producto
            </button>
        </div>
        <table id="productsTable" class="table table-dark table-striped table-bordered">
            <thead>
                <tr>
                    <th>SKU</th>
                    <th>Nombre</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Tipo</th>
                    <th>Varante</th>
                    <th>Unidad/Kg</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <% products.forEach(product=> { %>
                    <tr>
                        <td>
                            <%= product.sku %>
                        </td>
                        <td>
                            <%= product.name %>
                        </td>
                        <td>
                            <%= product.price_formated %>
                        </td>
                        <td>
                            <%= product.stock_formated %>
                        </td>
                        <td>
                            <%= product.type %>
                        </td>
                        <td>
                            <%= product.variant %>
                        </td>
                        <td>
                            <%= product.measurement %>
                        </td>
                        <td>
                            <a href="#" class="btn btn-sm btn-primary edit-btn" data-bs-toggle="modal"
                                data-bs-target="#editProductModal" data-id="<%= product.id %>">Editar</a>
                            &nbsp; &nbsp;
                            <a href="#" class="btn btn-sm btn-danger delete-btn" data-bs-toggle="modal"
                                data-bs-target="#deleteProductModal" data-id="<%= product.id %>">Eliminar</a>
                        </td>
                    </tr>
                    <% }) %>
            </tbody>
        </table>
    </div>

    <!-- Modal Agregar Producto -->
    <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProductModalLabel">
                        Agregar Producto
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <form action="/add_product" method="post">
                        <div class="form-group">
                            <label for="name_product">Nombre Producto: </label>
                            <input type="text" name="name_product" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="sku_product">SKU: </label>
                            <input type="text" name="sku_product" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="measurement">UNI/KG:</label>
                            <input type="text" name="measurement" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="price_product">Precio: </label>
                            <input type="number" name="price_product" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="type_product">Tipo:</label>
                            <input type="text" name="type_product" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="variant">Variante:</label>
                            <input type="text" name="variant" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="stock">Stock:</label>
                            <input type="number" name="stock" class="form-control" required />
                        </div>
                        <br>
                        <button type="submit" class="btn btn-primary">
                            Agregar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Agregar Cliente -->
    <div class="modal fade" id="agregarClienteModal" aria-labelledby="agregarClientteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="agregarClienteModalLabel">
                        Agregar Cliente
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <form action="/add_client" method="post">
                        <div class="form-group">
                            <label for="client_name">Nombre: &nbsp; &nbsp; </label>
                            <input type="text" name="client_name" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="client_rut">Rut: &nbsp; &nbsp; </label>
                            <input type="text" name="client_rut" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="client_email">Email: &nbsp; &nbsp; </label>
                            <input type="email" name="client_email" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="cell_phone">Celular: &nbsp; &nbsp; </label>
                            <input type="text" name="cell_phone" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="client_address">Direccion: &nbsp; &nbsp; </label>
                            <input type="text" name="client_address" class="form-control" required />
                        </div>
                        <br>
                        <button type="submit" class="btn btn-primary">
                            Agregar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Agregar -->
    <div class="modal fade" id="agregarModal" tabindex="-1" aria-labelledby="agregarModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="agregarModalLabel">
                        Agregar Venta
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">

                    <form action="/add" method="post">
                        <div class="form-group">
                            <label for="cantidad_producto">Cantidad</label>
                            <input type="number" name="cantidad_producto" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="sku_producto">SKU</label>
                            <input type="text" name="sku_producto" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="id_cliente">ID Cliente</label>
                            <input type="text" name="id_cliente" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="precio_producto">Precio Unitario</label>
                            <input type="text" name="precio_producto" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="total">Total</label>
                            <input type="number" name="total" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="fecha_venta">Fecha Venta</label>
                            <input type="date" name="fecha_venta" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="metodo_pago">Método de Pago</label>
                            <input type="text" name="metodo_pago" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="nombre_producto">Nombre Producto</label>
                            <input type="text" name="nombre_producto" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="nombre_cliente">Nombre Cliente</label>
                            <input type="text" name="nombre_cliente" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="resto_venta">Resto Venta</label>
                            <input type="number" name="resto_venta" class="form-control" required />
                        </div>
                        <div class="form-group">
                            <label for="estado">Estado</label>
                            <input type="text" name="estado" class="form-control" required />
                        </div>
                        <br>
                        <button type="submit" class="btn btn-primary">
                            Agregar
                        </button>
                    </form>
                    <table id="produTable" class="table table-dark table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Cantidad</th>
                                <th>Precio Unitario</th>
                                <th>Descuento</th>
                                <th>Sub Total</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- <% clients.forEach(client=> { %> 
                            <tr>
                                <td>
                                    <%= client.name %>
                                </td>
                                <td>
                                     <%= client.rut %> 
                                </td>
                                <td>
                                    <%= client.email %> 
                                </td>
                                <td>
                                   <%= client.cell_phone %> 
                                </td>
                                <td>
                                     <%= client.address %> 
                                </td>
                                <td>
                                   <%= client.address %> 
                                </td>
                               <td>
                                        <a href="#" class="btn btn-sm btn-primary edit-btn" data-bs-toggle="modal"
                                            data-bs-target="#editClientModal" data-id="<%= client.id %>">Editar</a>
                                        &nbsp; &nbsp;
                                        <a href="#" class="btn btn-sm btn-danger delete-btn" data-bs-toggle="modal"
                                            data-bs-target="#deleteClientModal" data-id="<%= client.id %>">Eliminar</a>
                                    </td> 
                            </tr> 
                             <% }) %> -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Agregar venta-->
    <div class="modal fade" id="addSaleModal" tabindex="-1" aria-labelledby="addSaleModalLabel" aria-hidden="true"
        data-bs-target="#staticBackdrop">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addSaleModalLabel">
                        Agregar Venta
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <form action="/add_sale" method="post">
                            <div class="row">
                                <div class="col-md-1 ">
                                    <label for="id_client_select">Cliente: </label>
                                </div>
                                <div class="col-md-5 ">
                                    <div class="form-group">
                                        <select class="form-select" data-live-search="true"
                                            aria-label="selectClientSale" name="id_client_select" id="id_client_select" required>
                                            <% clients.forEach(client=> { %>
                                                <option value=<%=client.id %>><%= client.name %>
                                                </option>
                                                <% }) %>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-2 " style="align-content: end;">
                                    <label for="sale_date">Fecha Venta:</label>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="date" name="sale_date" id="sale_date" class="form-control" required />
                                    </div>
                                    <!-- <input type="date" name="fecha_venta" class="form-control" required /> -->
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-2 ">
                                    <label for="payment_method">Método de Pago: </label>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" name="payment_method" id="payment_method" class="form-control" required />
                                    </div>
                                </div>
                                <div class="col-md-2 ">
                                    <label for="amount_paid">Monto Pagado: </label>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="number" name="amount_paid" id="amount_paid" class="form-control" required />
                                    </div>
                                </div>

                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-2 ">
                                    <label for="status_sale">Estado: </label>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" name="status_sale" id="status_sale" class="form-control" required />
                                    </div>
                                </div>
                                <br>
                                <br>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-1 ">
                                    <label for="id_product_select">Productos: </label>
                                </div>
                                <div class="col-md-4 ">
                                    <select class="form-select" data-live-search="true" aria-label="selectProductsSale"
                                        name="id_product_select" id="id_product_select" required>
                                        <% products.forEach(product=> { %>
                                            <option value="<%= product.id %>">
                                                <%= product.name %>, Precio: $<%= product.price_formated %>
                                            </option>
                                            <% }) %>
                                    </select>
                                </div>
                                <div class="col-md-1 ">
                                    <label for="quantity">Cantidad:</label>
                                </div>
                                <div class="col-md-1 ">
                                    <div class="form-group">
                                        <input type="number" min="1" value="1" name="quantity" class="form-control"
                                            id="quantity" required />
                                    </div>
                                </div>

                                <div class="col-md-1 ">
                                    <label for="quantity">Descuento:</label>
                                </div>
                                <div class="col-md-2 ">
                                    <div class="form-group">
                                        <input type="number" min="0" name="discount" id="discount" class="form-control"
                                            value="0" required />
                                    </div>
                                </div>
                                <div class="col-sm-2 ">
                                    <button class="btn btn-primary btn-sm" id="add_product_sale">
                                        Agregar Producto
                                    </button>
                                </div>
                            </div>
                            <br>
                            <br>
                            <div class="row">
                                <div class="container mt-12">
                                    <table id="productSaleTable" class="table table-dark table-striped table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Nombre</th>
                                                <th>Cantidad</th>
                                                <th>Precio Unitario</th>
                                                <th>Descuento</th>
                                                <th>Sub Total</th>
                                                <!-- <th>Acciones</th> -->
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- <div class="row">
                                <div class="col-md-1">
                                    <button type="submit" class="btn btn-primary">
                                        Agregar
                                    </button>
                                </div>
                            </div> -->
                        </form>
                        <br>



                    </div>
                    <div class="row">
                        <button class="btn btn-primary" id="button_add_product_sale">
                            Agregar venta
                        </button>

                    </div>

                </div>
            </div>
        </div>
    </div>



    <!-- Modal Editar -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">
                        Editar Venta
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm" method="post">
                        <div class="form-group">
                            <label for="cantidad_producto">Cantidad</label>
                            <input type="text" name="cantidad_producto" class="form-control" id="cantidad_producto" />
                        </div>
                        <div class="form-group">
                            <label for="sku_producto">SKU</label>
                            <input type="text" name="sku_producto" class="form-control" id="sku_producto" />
                        </div>
                        <div class="form-group">
                            <label for="id_cliente">ID Cliente</label>
                            <input type="text" name="id_cliente" class="form-control" id="id_cliente" />
                        </div>
                        <div class="form-group">
                            <label for="precio_producto">Precio Unitario</label>
                            <input type="text" name="precio_producto" class="form-control" id="precio_producto" />
                        </div>
                        <div class="form-group">
                            <label for="total">Total</label>
                            <input type="number" name="total" class="form-control" id="total" />
                        </div>
                        <div class="form-group">
                            <label for="fecha_venta">Fecha Venta</label>
                            <input type="date" name="sale_date" class="form-control" id="sale_date" />
                        </div>
                        <div class="form-group">
                            <label for="metodo_pago">Método de Pago</label>
                            <input type="text" name="metodo_pago" class="form-control" id="metodo_pago" />
                        </div>
                        <div class="form-group">
                            <label for="nombre_producto">Nombre Producto</label>
                            <input type="text" name="nombre_producto" class="form-control" id="nombre_producto" />
                        </div>
                        <div class="form-group">
                            <label for="nombre_cliente">Nombre Cliente</label>
                            <input type="text" name="nombre_cliente" class="form-control" id="nombre_cliente" />
                        </div>
                        <div class="form-group">
                            <label for="resto_venta">Resto Venta</label>
                            <input type="number" name="resto_venta" class="form-control" id="resto_venta" />
                        </div>
                        <div class="form-group">
                            <label for="status_sale">Estado</label>
                            <input type="text" name="status_sale" class="form-control" id="status_sale" />
                        </div>
                        <br>
                        <button type="submit" class="btn btn-primary">
                            Guardar Cambios
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Delete Product -->
    <div class="modal fade" id="deleteProductModal" tabindex="-1" aria-labelledby="deleteProductModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteProductModalLabel">
                        Eliminar Product
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <p>¿Está seguro de que desea eliminar el producto ?</p>
                </div>
                <div class="modal-footer">
                    <form id="deleteFormProduct" method="post" action>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                            Cancelar
                        </button>
                        &nbsp;
                        <button type="submit" class="btn btn-success">
                            Confirmar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal Delete Client -->
    <div class="modal fade" id="deleteClientModal" tabindex="-1" aria-labelledby="deleteClientModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteClientModalLabel">
                        Eliminar Cliente
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <p>¿Está seguro de que desea eliminar el cliente ?</p>
                </div>
                <div class="modal-footer">
                    <form id="deleteFormClient" method="post" action>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                            Cancelar
                        </button>
                        &nbsp;
                        <button type="submit" class="btn btn-success">
                            Confirmar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Eliminar -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">
                        Eliminar Venta
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <p>¿Está seguro de que desea eliminar esta venta?</p>
                </div>
                <div class="modal-footer">
                    <form id="deleteForm" method="post" action="">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-danger">
                            Eliminar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Editar Cliente -->
    <div class="modal fade" id="editClientModal" tabindex="-1" aria-labelledby="editClientModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editClientModalLabel">
                        Editar Cliente
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <form id="editClienteForm" method="post">
                        <div class="form-group">
                            <label for="client_name">Nombre: &nbsp; &nbsp; </label>
                            <input type="text" name="client_name" class="form-control" id="client_name_edit" required />
                        </div>
                        <div class="form-group">
                            <label for="client_rut">Rut: &nbsp; &nbsp; </label>
                            <input type="text" name="client_rut" class="form-control" id="client_rut_edit" required />
                        </div>
                        <div class="form-group">
                            <label for="client_email">Email: &nbsp; &nbsp; </label>
                            <input type="email" name="client_email" class="form-control" id="client_email_edit"
                                required />
                        </div>
                        <div class="form-group">
                            <label for="cell_phone">Celular: &nbsp; &nbsp; </label>
                            <input type="text" name="cell_phone" class="form-control" id="cell_phone_edit" required />
                        </div>
                        <div class="form-group">
                            <label for="client_address">Direccion: &nbsp; &nbsp; </label>
                            <input type="text" name="client_address" class="form-control" id="client_address_edit"
                                required />
                        </div>
                        <br>
                        <button type="submit" class="btn btn-primary">
                            Guardar Cambios
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Editar Producto -->
    <div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProductModalLabel">
                        Editar Producto
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    <form id="editProductForm" method="post">
                        <div class="form-group">
                            <label for="name_product">Nombre Producto: &nbsp; &nbsp; </label>
                            <input type="text" name="name_product" class="form-control" id="name_product_edit"
                                required />
                        </div>
                        <div class="form-group">
                            <label for="sku_product">SKU: &nbsp; &nbsp; </label>
                            <input type="text" name="sku_product" class="form-control" id="sku_product_edit" required />
                        </div>
                        <div class="form-group">
                            <label for="measurement">UNI/KG: &nbsp; &nbsp; </label>
                            <input type="text" name="measurement" class="form-control" id="measurement_edit" required />
                        </div>
                        <div class="form-group">
                            <label for="price_product">Precio: &nbsp; &nbsp; </label>
                            <input type="number" name="price_product" class="form-control" id="price_product_edit"
                                required />
                        </div>
                        <div class="form-group">
                            <label for="tipo">Tipo: &nbsp; &nbsp; </label>
                            <input type="text" name="type_product" class="form-control" id="type_product_edit"
                                required />
                        </div>
                        <div class="form-group">
                            <label for="variant">Variante: &nbsp; &nbsp; </label>
                            <input type="text" name="variant" class="form-control" id="variant_edit" required />
                        </div>
                        <div class="form-group">
                            <label for="stock">Stock: &nbsp; &nbsp; </label>
                            <input type="number" name="stock" class="form-control" id="stock_edit" required />
                        </div>
                        <br>
                        <button type="submit" class="btn btn-primary">
                            Guardar Cambios
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.4/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.full.min.js"></script>
    <script>
        const arrProduct = [`{'id','222','2','id','222','2'}`]
        document.addEventListener("DOMContentLoaded", function () {
            // Inicializar DataTables
            $("#ventasTable").DataTable({
                responsive: true, // Hacer la tabla responsiva
                pageLength: 10, // Número de filas por página
                language: {
                    // Traducciones al español (puedes personalizarlas según tus necesidades)
                    lengthMenu: "Mostrar _MENU_ registros por página",
                    zeroRecords: "No se encontraron resultados",
                    info: "Mostrando página _PAGE_ de _PAGES_",
                    infoEmpty: "No hay registros disponibles",
                    infoFiltered: "(filtrado de _MAX_ registros totales)",
                    search: "Buscar Ventas:",
                    paginate: {
                        first: "Primero",
                        last: "Último",
                        next: "Siguiente",
                        previous: "Anterior",
                    },
                },
            });
            // Restringir la búsqueda para que no sea sensible a mayúsculas/minúsculas
            $.fn.dataTable.ext.type.search.string = function (data) {
                return !data
                    ? ""
                    : typeof data === "string"
                        ? data
                            .replace(/έ/g, "ε")
                            .replace(/ύ/g, "υ")
                            .replace(/ό/g, "ο")
                            .replace(/ώ/g, "ω")
                            .replace(/ά/g, "α")
                            .replace(/ί/g, "ι")
                            .replace(/ή/g, "η")
                            .replace(/έ/g, "ε")
                            .replace(/ς/g, "σ")
                            .replace(/ϊ/g, "ι")
                            .replace(/ΰ/g, "υ")
                            .replace(/ϋ/g, "υ")
                            .replace(/ΐ/g, "ι")
                        : data;
            };

        });

        document.addEventListener("DOMContentLoaded", function () {
            var data = []
            let total_amount_product = 0
            var table2 = $('#productSaleTable').DataTable({
                responsive: true, // Hacer la tabla responsiva
                pageLength: 5, // Número de filas por página
                language: {
                    // Traducciones al español (puedes personalizarlas según tus necesidades)
                    lengthMenu: "Mostrar _MENU_ registros por página",
                    zeroRecords: "No se encontraron resultados",
                    info: "Mostrando página _PAGE_ de _PAGES_",
                    infoEmpty: "No hay registros disponibles",
                    infoFiltered: "(filtrado de _MAX_ registros totales)",
                    search: "Buscar productos agregados:",
                    paginate: {
                        first: "Primero",
                        last: "Último",
                        next: "Siguiente",
                        previous: "Anterior",
                    },
                },

                data: data,
                columns: [
                    { data: 'name' },
                    { data: 'quantity' },
                    { data: 'price_formated' },
                    { data: 'discount' },
                    { data: 'subTotal' }
                ],
            })
            // Restringir la búsqueda para que no sea sensible a mayúsculas/minúsculas
            $.fn.dataTable.ext.type.search.string = function (data) {
                return !data
                    ? ""
                    : typeof data === "string"
                        ? data
                            .replace(/έ/g, "ε")
                            .replace(/ύ/g, "υ")
                            .replace(/ό/g, "ο")
                            .replace(/ώ/g, "ω")
                            .replace(/ά/g, "α")
                            .replace(/ί/g, "ι")
                            .replace(/ή/g, "η")
                            .replace(/έ/g, "ε")
                            .replace(/ς/g, "σ")
                            .replace(/ϊ/g, "ι")
                            .replace(/ΰ/g, "υ")
                            .replace(/ϋ/g, "υ")
                            .replace(/ΐ/g, "ι")
                        : data;
            };

            $("#add_product_sale").on('click', function () {
                let id = $("#id_product_select").val()
                let quantity = $("#quantity").val();
                let discount = $("#discount").val();
                // // // Obtener los datos de la venta seleccionada y mostrarlos en el formulario de edición
                fetch(`/edit_product/${id}`)
                    .then((response) => response.json())
                    .then((dataProduct) => {
                        const rowToAdd = {
                            id: dataProduct.id,
                            name: dataProduct.name,
                            price: dataProduct.price,
                            stock: dataProduct.stock,
                            type: dataProduct.type,
                            variant: dataProduct.variant,
                            measurement: dataProduct.measurement,
                            price_formated: dataProduct.price_formated,
                            stock_formated: dataProduct.stock_formated,
                            quantity: quantity,
                            discount: discount,
                            subTotal: dataProduct.price * quantity - discount
                        }
                        total_amount_product += rowToAdd.subTotal;
                        data.push(rowToAdd)
                        table2.row.add(rowToAdd).draw(false);
                        console.log(data)
                        // console.log(dataProduct)
                    })
                    .catch((error) => {
                        console.error(
                            "Error al obtener los datos de la venta:",
                            error
                        )
                    });
            });

            $("#button_add_product_sale").on('click', async function () {
                let client = $("#id_client_select").val();
                let sales_date = $("#sale_date").val();
                let status_sale = $("#status_sale").val();
                let payment_method = $("#payment_method").val();
                let amount_paid_sale = $("#amount_paid").val();
                let total_amount = total_amount_product;

                let auxProduct = {
                    products: data,
                    sales_date: sales_date,
                    id_client_select: client,
                    status_sale: status_sale,
                    payment_method: payment_method,
                    total_amount: total_amount,
                    amount_paid: amount_paid_sale,

                }
                console.log("auxProduct", auxProduct)
                try {
                    const response = await $.ajax({
                        type: "POST",
                        url: '/add_sale/',
                        dataType: "json",
                        data: auxProduct
                    });

                    if (response.success) {
                        console.log("Registro creado exitosamente.");
                        location.reload();
                        // Mostrar algún mensaje de confirmación al usuario si lo deseas
                    } else {
                        console.error(
                            "Error al eliminar el registro:",
                            response.message
                        );
                        alert("Error al eliminar el registro");
                    }
                    // Actualizar la tabla después de eliminar el registro
                    // $('#ventasTable').DataTable().ajax.reload(null, false);
                } catch (error) {
                    console.error(
                        "Error al eliminar el registro:",
                        error.stack
                    );
                    console.log(error);
                    alert("Error al eliminar el registro");
                }
            })

        })
        document.addEventListener("DOMContentLoaded", function () {
            // Inicializar DataTables
            $("#clientsTable").DataTable({
                responsive: true, // Hacer la tabla responsiva
                pageLength: 10, // Número de filas por página
                language: {
                    // Traducciones al español (puedes personalizarlas según tus necesidades)
                    lengthMenu: "Mostrar _MENU_ registros por página",
                    zeroRecords: "No se encontraron resultados",
                    info: "Mostrando página _PAGE_ de _PAGES_",
                    infoEmpty: "No hay registros disponibles",
                    infoFiltered: "(filtrado de _MAX_ registros totales)",
                    search: "Buscar Cliente:",
                    paginate: {
                        first: "Primero",
                        last: "Último",
                        next: "Siguiente",
                        previous: "Anterior",
                    },
                },
            });

            // Restringir la búsqueda para que no sea sensible a mayúsculas/minúsculas
            $.fn.dataTable.ext.type.search.string = function (data) {
                return !data
                    ? ""
                    : typeof data === "string"
                        ? data
                            .replace(/έ/g, "ε")
                            .replace(/ύ/g, "υ")
                            .replace(/ό/g, "ο")
                            .replace(/ώ/g, "ω")
                            .replace(/ά/g, "α")
                            .replace(/ί/g, "ι")
                            .replace(/ή/g, "η")
                            .replace(/έ/g, "ε")
                            .replace(/ς/g, "σ")
                            .replace(/ϊ/g, "ι")
                            .replace(/ΰ/g, "υ")
                            .replace(/ϋ/g, "υ")
                            .replace(/ΐ/g, "ι")
                        : data;
            };
        });

        document.addEventListener("DOMContentLoaded", function () {
            // Inicializar DataTables
            $("#productsTable").DataTable({
                responsive: true, // Hacer la tabla responsiva
                pageLength: 10, // Número de filas por página
                language: {
                    // Traducciones al español (puedes personalizarlas según tus necesidades)
                    lengthMenu: "Mostrar _MENU_ registros por página",
                    zeroRecords: "No se encontraron resultados",
                    info: "Mostrando página _PAGE_ de _PAGES_",
                    infoEmpty: "No hay registros disponibles",
                    infoFiltered: "(filtrado de _MAX_ registros totales)",
                    search: "Buscar Producto:",
                    paginate: {
                        first: "Primero",
                        last: "Último",
                        next: "Siguiente",
                        previous: "Anterior",
                    },
                },
            });

            // Restringir la búsqueda para que no sea sensible a mayúsculas/minúsculas
            $.fn.dataTable.ext.type.search.string = function (data) {
                return !data
                    ? ""
                    : typeof data === "string"
                        ? data
                            .replace(/έ/g, "ε")
                            .replace(/ύ/g, "υ")
                            .replace(/ό/g, "ο")
                            .replace(/ώ/g, "ω")
                            .replace(/ά/g, "α")
                            .replace(/ί/g, "ι")
                            .replace(/ή/g, "η")
                            .replace(/έ/g, "ε")
                            .replace(/ς/g, "σ")
                            .replace(/ϊ/g, "ι")
                            .replace(/ΰ/g, "υ")
                            .replace(/ϋ/g, "υ")
                            .replace(/ΐ/g, "ι")
                        : data;
            };
        });

        document.addEventListener("DOMContentLoaded", function () {
            // Obtener el formulario de edición cuando se muestra el modal editar
            $("#editModal").on("show.bs.modal", function (event) {
                const button = $(event.relatedTarget); // Botón que activó el modal
                const id = button.data("id"); // Extraer el ID de los datos atributos del botón
                const form = document.getElementById("editForm");
                form.action = `/edit/${id}`; // Actualizar el atributo 'action' del formulario
                console.log("el id", id)
                // Obtener los datos de la venta seleccionada y mostrarlos en el formulario de edición
                fetch(`/edit/${id}`)
                    .then((response) => response.json())
                    .then((data) => {
                        form.elements.cantidad_producto.value =
                            data.cantidad_producto;
                        form.elements.sku_producto.value =
                            data.sku_producto;
                        form.elements.id_cliente.value = data.id_cliente;
                        form.elements.precio_producto.value =
                            data.precio_producto;
                        form.elements.total.value = data.total;
                        form.elements.fecha_venta.value = data.fecha_venta;
                        form.elements.metodo_pago.value = data.metodo_pago;
                        form.elements.nombre_producto.value =
                            data.nombre_producto;
                        form.elements.nombre_cliente.value =
                            data.nombre_cliente;
                        form.elements.resto_venta.value = data.resto_venta;
                        form.elements.estado.value = data.estado;
                    })
                    .catch((error) =>
                        console.error(
                            "Error al obtener los datos de la venta:",
                            error
                        )
                    );
            });

            /** editar cliente modal*/
            $("#editClientModal").on("show.bs.modal", function (event) {
                const button = $(event.relatedTarget); // Botón que activó el modal
                const id = button.data("id"); // Extraer el ID de los datos atributos del botón
                const form = document.getElementById("editClienteForm");
                form.action = `/edit_client/${id}` // Actualizar el atributo 'action' del formulario
                console.log("el id", id)
                // Obtener los datos de la venta seleccionada y mostrarlos en el formulario de edición
                fetch(`/edit_client/${id}`)
                    .then((response) => response.json())
                    .then((data) => {
                        form.elements.client_name_edit.value = data.name;
                        form.elements.client_rut_edit.value = data.rut;
                        form.elements.client_email_edit.value = data.email;
                        form.elements.cell_phone_edit.value = data.cell_phone;
                        form.elements.client_address_edit.value = data.address;
                    })
                    .catch((error) =>
                        console.error(
                            "Error al obtener los datos de la venta:",
                            error
                        )
                    );
            });

            /** editar cliente modal*/
            $("#editProductModal").on("show.bs.modal", function (event) {
                const button = $(event.relatedTarget); // Botón que activó el modal
                const id = button.data("id"); // Extraer el ID de los datos atributos del botón
                const form = document.getElementById("editProductForm");
                form.action = `/edit_product/${id}` // Actualizar el atributo 'action' del formulario
                console.log("el id", id)
                // Obtener los datos de la venta seleccionada y mostrarlos en el formulario de edición
                fetch(`/edit_product/${id}`)
                    .then((response) => response.json())
                    .then((data) => {
                        console.log(data)
                        form.elements.name_product_edit.value = data.name;
                        form.elements.sku_product.value = data.sku;
                        form.elements.measurement_edit.value = data.measurement;
                        form.elements.price_product_edit.value = data.price;
                        form.elements.type_product_edit.value = data.type;
                        form.elements.variant_edit.value = data.variant;
                        form.elements.stock_edit.value = data.stock;
                    })
                    .catch((error) =>
                        console.error(
                            "Error al obtener los datos de la venta:",
                            error
                        )
                    );
            });

            // Obtener el formulario de eliminación cuando se muestra el modal eliminar
            $("#deleteModal").on("show.bs.modal", function (event) {
                const button = $(event.relatedTarget); // Botón que activó el modal
                const id = button.data("id"); // Extraer el ID de los datos atributos del botón
                console.log("ID del registro a eliminar:", id);
                const form = document.getElementById("deleteForm");
                form.action = `/delete/${id}`; // Actualizar el atributo 'action' del formulario
            });

            // Obtener el formulario de eliminación cuando se muestra el modal eliminar
            $("#deleteClientModal").on("show.bs.modal", function (event) {
                const button = $(event.relatedTarget); // Botón que activó el modal
                const id = button.data("id"); // Extraer el ID de los datos atributos del botón
                console.log("ID del registro a eliminar:", id);
                const form = document.getElementById("deleteFormClient");
                form.action = `/delete_client/${id}`; // Actualizar el atributo 'action' del formulario
                console.log(form.action)
            });

            // Obtener el formulario de eliminación cuando se muestra el modal eliminar
            $("#deleteProductModal").on("show.bs.modal", function (event) {
                const button = $(event.relatedTarget); // Botón que activó el modal
                const id = button.data("id"); // Extraer el ID de los datos atributos del botón
                console.log("ID del registro a eliminar:", id);
                const form = document.getElementById("deleteFormProduct");
                form.action = `/delete_product/${id}`; // Actualizar el atributo 'action' del formulario
                console.log(form.action)
            });

            // Eliminar el registro al enviar el formulario
            $("#deleteForm").on("submit", async function (event) {
                event.preventDefault();
                const url = this.action;
                console.log("URL de la solicitud DELETE:", url);
                // Realizar la solicitud de eliminación mediante AJAX
                try {
                    const response = await $.ajax({
                        type: "DELETE",
                        url: url,
                        dataType: "json",
                    });

                    if (response.success) {
                        console.log("Registro eliminado exitosamente.");
                        // location.reload();
                        // Mostrar algún mensaje de confirmación al usuario si lo deseas
                    } else {
                        console.error(
                            "Error al eliminar el registro:",
                            response.message
                        );
                        alert("Error al eliminar el registro");
                    }
                    // Actualizar la tabla después de eliminar el registro
                    // $('#ventasTable').DataTable().ajax.reload(null, false);
                } catch (error) {
                    console.error(
                        "Error al eliminar el registro:",
                        error.stack
                    );
                    console.log(error);
                    alert("Error al eliminar el registro");
                }
            });

            // Eliminar el registro al enviar el formulario
            $("#deleteFormClient").on("submit", async function (event) {
                event.preventDefault();
                const url = this.action;
                console.log("URL de la solicitud DELETE:", url);
                // Realizar la solicitud de eliminación mediante AJAX
                try {
                    const response = await $.ajax({
                        type: "DELETE",
                        url: url,
                        dataType: "json",
                    });

                    if (response.success) {
                        console.log("Registro eliminado exitosamente.");
                        location.reload();
                        // Mostrar algún mensaje de confirmación al usuario si lo deseas
                    } else {
                        console.error(
                            "Error al eliminar el registro:",
                            response.message
                        );
                        alert("Error al eliminar el registro");
                    }
                    // Actualizar la tabla después de eliminar el registro
                    // $('#ventasTable').DataTable().ajax.reload(null, false);
                } catch (error) {
                    console.error(
                        "Error al eliminar el registro:",
                        error.stack
                    );
                    console.log(error);
                    alert("Error al eliminar el registro");
                }
            });

            // Eliminar el registro al enviar el formulario
            $("#deleteFormProduct").on("submit", async function (event) {
                event.preventDefault();
                const url = this.action;
                console.log("URL de la solicitud DELETE:", url);
                // Realizar la solicitud de eliminación mediante AJAX
                try {
                    const response = await $.ajax({
                        type: "DELETE",
                        url: url,
                        dataType: "json",
                    });

                    if (response.success) {
                        console.log("Registro eliminado exitosamente.");
                        location.reload();
                        // Mostrar algún mensaje de confirmación al usuario si lo deseas
                    } else {
                        console.error(
                            "Error al eliminar el registro:",
                            response.message
                        );
                        alert("Error al eliminar el registro");
                    }
                    // Actualizar la tabla después de eliminar el registro
                    // $('#ventasTable').DataTable().ajax.reload(null, false);
                } catch (error) {
                    console.error(
                        "Error al eliminar el registro:",
                        error.stack
                    );
                    console.log(error);
                    alert("Error al eliminar el registro");
                }
            });

        });
    </script>
</body>

</html>